# Nissan ROI

## Overview
The Nissan ROI application is a Streamlit-based tool designed to calculate and analyze Return on Investment (ROI) metrics for apprentices and graduates. It processes Excel files containing apprentice and graduate data, calculates key financial metrics, and generates downloadable reports with projections and school-specific revenue breakdowns.

## Requirements
1. Python 3.8+
2. Required Python packages:
    - streamlit
    - pandas
    - numpy
    - openpyxl

## File Structure
The application consists of two main files:
- `nissan_roi.py` - Main application logic
- `roi_support.py` - Supporting functions and utilities

## Data Requirements
1. Input must be Excel files (.xlsx)
2. Expected files:
    - NTTA Status Report (current month)
    - Apprentice RO Monthly Trend file
    - Fulltime Hired Graduates RO Monthly Trend file
3. Expected columns in the files:
    - LMSID (unique student identifier)
    - First_Name
    - Last_Name
    - Employee_Student_Full_Name
    - PART_TOTAL_COST
    - PART_TOTAL_PRICE
    - LABOR_AMT

## Main Functions

### **`nissan_roi.py`**

#### `roi_main()`
The main function that runs the Streamlit application for ROI calculations.

**Functionality:**

1. Sets up the Streamlit interface
2. Accepts file uploads for:
    - NTTA Status Report
    - Apprentice RO Monthly Trend file
    - Fulltime Hired Graduates RO Monthly Trend file
3. Processes and cleans the uploaded files
4. Calculates key financial metrics:
    - Part total cost
    - Part total price
    - Labor amount
    - Adjusted P&L
5. Generates downloadable Excel files with:
    - Actual ROI data
    - Projected ROI data

**Key Features:**
1. Handles Excel file uploads
2. Calculates moving averages for projections
3. Generates downloadable Excel files with frozen panes

#### `roi_by_school()`
The function that calculates revenue by school.

**Functionality:**
1. Processes uploaded files
2. Maps students to their respective schools
3. Calculates revenue generated by each school
4. Generates downloadable Excel file with school-specific revenue breakdown

**Key Features:**
1. Tracks revenue by school
2. Handles unknown schools
3. Generates downloadable Excel file

### `roi_support.py`

#### `extract_date(file_name)`
Extracts and formats the date from the file name.

**Parameters:**
- `file_name` (str): Name of the uploaded file

**Returns:**
- Formatted date string (`yyyy-mm-dd`)

#### `pick_ro()`
Handles file selection for RO Monthly Trend files.

**Returns:**
- Two DataFrames (Apprentice and Graduate RO data) 

#### `pick_ntta()`
Handles file selection for NTTA Status Report.

**Returns:**
- Two DataFrames (Apprentice and Graduate NTTA data)

#### `calculate_moving_average(df, num_rows_to_add, max_window_size)`
Calculates moving averages for projections.

**Parameters:**
- `df` (DataFrame): DataFrame to process
- `num_rows_to_add` (int): Number of rows to add for projections
- `max_window_size` (int): Maximum window size for moving average

**Returns:**
- DataFrame with added projections

#### `write_to_excel(df)`
Writes a DataFrame to an Excel file.

**Parameters:**
- `df` (DataFrame): DataFrame to export

**Returns:**
- Excel file as bytes

## Running the Application
1. Install required packages:
   ```bash
   pip install streamlit pandas numpy openpyxl
   ```
2. Run the application:
   ```bash
   streamlit run nissan_roi.py
   ```
3. Access the application in your web browser at `http://localhost:8501`

## Error Handling
- The application includes basic error handling for:
    - File upload errors
    - Missing or invalid Excel sheets
    - Data processing errors
    - File format errors

## Output
- The application provides:
    - Updated ROI tracker Excel file (actual values)
    - Projected ROI tracker Excel file
    - School-specific revenue breakdown Excel file

## Limitations
- Requires specific file structure and naming conventions
- Assumes consistent column names in all Excel files